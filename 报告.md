#Project Final
***申文钦   自动化62 2160504046***
###一、边缘检测
 本次实验中采取了三种边缘检测方法：sobel算子、LOG算子和canny检测，对基本原理做如下简述：    
 Sobel算子：sobel算子是一种梯度算子，是对于一阶导数的近似实现，也应此，sobel算子是对应于特定方向的，在实现中，我们使用水平和垂直两个方向的sobel算子检测边缘（matlab中sobel边缘检测默认模式为两个方向），sobel模板各方向中心使用的权数大于两边权数使得其具有平滑图像的作用。算子模板如下图所示
![Eo8itS.png](https://s2.ax1x.com/2019/05/14/Eo8itS.png)

LOG算子：1980年，Marr和Hildreth提出将Laplace算子与高斯低通滤波相结合，提出了LOG（Laplace and Guassian）算子。

步骤如下：

1.对图像先进性高斯滤波，再进行Laplace算子运算；

2.保留一阶导数峰值的位置，从中寻找Laplace过零点；

3.对过零点的精确位置进行插值估计。

LOG算子如下：
![EoJ9JS.png](https://s2.ax1x.com/2019/05/14/EoJ9JS.png)

根据sigma的不同以及3sigma原则可以建立不同的模板，sigma是一个尺度参数，在图像处理中引入尺度以及建立多尺度空间是一个重要的突破，sigma越大，图像越模糊滤除噪声效果越好，sigma越小，效果相反。
常用模板如下：

![EoJPzQ.png](https://s2.ax1x.com/2019/05/14/EoJPzQ.png)

Canny算子基本步骤：

1. 用一个高斯模板滤波器平滑输入图像。
2. 计算梯度幅值图像和角度图像。
3. 对梯度图像幅值应用非最大抑制。
4. 用双阈值处理和连接分析来检测并连接边缘。

对于canny方法中区别于其他方法的几点进行说明：

- canny算法中将梯度方向定义为四种:水平、垂直、+45、-45,非最大抑制是在此基础之上实现的。
- 非最大抑制是在每个像素最接近方向，和相邻像素的梯度幅值进行比较，抑制那些拥有较小的值像素。
- canny中采用双阈值，在非最大抑制的基础上用两个阈值TH和TL将边缘分为强边缘和弱边缘，连接每个强边缘附近的有效弱边缘，形成最终结果。

在本次实验中，我们使用使用edge函数实现上述三种算子。
###二、hough变换检测直线

霍夫变换是图像处理中的一种特征提取技术，可以识别图像中的几何形状。它将图像空间中的特征点映射到参数空间进行投票，通过检测累计结果的局部极值点得到一个符合某特定形状的点的集合。经典霍夫变换用来检测图像中的直线，后来霍夫变换扩展到任意形状物体的识别，多为圆和椭圆。它的抗噪声、抗形变能力较强。另一种直线提取的方法是对图像边缘点进行链码追踪，在得到的链码串中提取直线。霍夫变换将在一个空间中具有相同形状的曲线或直线映射到另一个坐标空间的一个点上形成峰值，从而把检测任意形状的问题转化为统计峰值问题。

考虑点和线的对应关系，过一点（x1,y1）的直线可表示为：y1=kx1+b，将变量和参数互换，已知一个点(x1,y1),经过这一点的直线簇可以表示为b=(-x1)k+y1。位于同一条直线上的点具有相同的斜率和截距，反映到参数空间上就是这些直线会交于同一点(k,b)。采用极坐标的方式：Rho = X * Cos(Theta) + Y * Sin(Theta)：

![EoJ5Os.png](https://s2.ax1x.com/2019/05/14/EoJ5Os.png)

而细分的数量决定了点共线的精度，参数Theta设置的范围将决定能检测到多大斜率的直线。               
在本次实验中，我们将改变Theta的范围和极值点的数量来观察其影响。

###三、具体实现和结果

边缘检测实现代码：

```
T2s = edge(test2,'sobel')；
T2s = edge(test2,'log')；
T2s = edge(test2,'Canny')；
```

直线检测代码：
```
function houghdec(Image,range,peaknumber,ImgOri)
% Create the Hough transform using the binary image
[H,T,R] = hough(Image,'Theta',range); 
%求极值点
Peaks=houghpeaks(H,peaknumber); 
%得到线段信息 
lines=houghlines(Image,T,R,Peaks);
imshow(ImgOri), hold on;
for k = 1:length(lines)
   xy = [lines(k).point1; lines(k).point2];
   plot(xy(:,1),xy(:,2),'LineWidth',2,'Color','red');
   plot(xy(1,1),xy(1,2),'x','LineWidth',1,'Color','yellow'); % Plot beginnings and ends of lines
   plot(xy(2,1),xy(2,2),'x','LineWidth',1,'Color','yellow');
end
end
```

实验结果截图：

六张图的sobel算子边缘检测和直线检测
[![EotcRS.md.png](https://s2.ax1x.com/2019/05/14/EotcRS.md.png)](https://imgchr.com/i/EotcRS)

六张图的log算子边缘检测和直线检测

[![EotRMQ.md.png](https://s2.ax1x.com/2019/05/14/EotRMQ.md.png)](https://imgchr.com/i/EotRMQ)

六张图的canny算子边缘检测和直线检测

[![Eotfqs.md.png](https://s2.ax1x.com/2019/05/14/Eotfqs.md.png)](https://imgchr.com/i/Eotfqs)

hough变换的thera范围变化

[![EotvZR.md.png](https://s2.ax1x.com/2019/05/14/EotvZR.md.png)](https://imgchr.com/i/EotvZR)

hough变换极值点选择数目变化

[![EotzIx.md.png](https://s2.ax1x.com/2019/05/14/EotzIx.md.png)](https://imgchr.com/i/EotzIx)


###三、结果分析

这里对于三个边缘检测算法进行比较分析，并结合上图对直线检测结果进行一定分析。 

边缘检测结果分析：

canny边缘有更好好的完整性和连通性，不易受噪声干扰，能够检测到真正的弱边缘。而且使用两种不同的阈值分别检测强边缘和弱边缘，并且当弱边缘和强边缘相连时，才将弱边缘包含在输出图像中。

sobel检测边缘时，梯度检测边缘固有的缺陷使得在最后阈值分割时很容易将一些响应较小的边缘，这类边缘包括倾斜边缘和与背景像素十分接近的边缘，在实验中一些和背景像素值十分接近的倾斜边缘就无法检测。canny边缘检测中并不存在这样的问题。并且sobel检测中会对很多无关的边缘有响应，而canny方法中对无关特性的抑制较好，在test6中较为明显。


LOG算子法对噪声比较敏感，所以很少用该算子检测边缘，而是用来判断边缘像素视为与图像的明区还是暗区。这是一种二阶导数算子，将在边缘处产生一个陡峭的零交叉, 但其能对任何走向的界线和线条进行锐化，无方向性。这是拉普拉斯算子区别于其他算法的最大优点。


直线检测结果分析：  

从每幅结果图像中能看出，直线检测与很多直线未标示和设置的参数有关，且边缘提取的结果直接影响到直线检测的结果。比如test6中由于sobel检测结果中有大量无关特性，导致直线检测中出现了非边缘的直线，很多叶子的检测点被连成一条直线。


第一行图像参数theta范围是（-90，89），以0.1细分。

第二行图像参数theta范围是（-60，59），以0.1细分。对比第一行test4图像明显看到，角度差异使得网格线中大部分水平线都没有检测出来。也就是说，theta决定了可检测的直线角度范围。但是这也告诉我们，如果我们对于水平线不感兴趣时，这个角度范围设的比较小也能获得所需结果。

第三行图像参数theta范围是（-30，29），以0.1细分。结果中可以看到，此时直线检测出了比较大的问题，只能检测出近乎垂直的直线，而且多数是重合的，不能很好的反映边缘，这说明theta的选取要适中，否则结果将不如预期。

对于相同的theta，当Hough变换中提取的极值点数目也影响直线检测结果。通过上述实验比较可以看出，当极值点数目较小时，检测到的直线数目也较少，而当极值点数目较大时，由于可以将原本更加断续的点纳入直线范畴，所以检测到的直线更多，且连续性更强。当然也有可能会引入无关边缘，所以极值点数目的选取要适中。

综上所述，我们在应用哈夫变换直线检测时候，我们对theta、细分程度和极值点数目的选取都要慎重。如果我们想获得较好的结果，这些参数的选择都要适中。